---
title: "An Analysis of Draft Picks In the NHL, NFL, NBA "
author: "Joshua Burke, Olivia Stewart, Sriyash Singhania"
date: "\\today"
output:
  rmdformats::readthedown:
    highlight: "kate"
---

```{r setup, include = FALSE}
# Set code chunk defaults 
# Consider adding `message = FALSE` option
knitr::opts_chunk$set(echo = FALSE) 
                      
# Set R environment options
options(knitr.kable.NA = '')

# Load packages
library(tidyverse)
library(maps)
library(sf)
library(kableExtra)
library(DT)
library(viridis)
library(ggplot2)
library(car)
library(leaflet)
library(rmdformats)
```

```{r, out.width="80%", fig.align="center"}
knitr::include_graphics("pictures/ALLSPORTSPICDS.jpeg")
```

# Intro

In this project, our group set out to take a more in-depth analysis of draft picks over the last 20 years of three of the four major sports leagues in North America. Since different sports leagues conduct their drafts in different fashions we decided to evaluate each sport differently to fit how the draft process is designed. In terms of each sport the NHL drafts players at the age of 18 and players are usually a few years away from being ready to play in the NHL. In the NBA, players have to be at least 19 years old to be drafted and once they are drafted they usually are meant to go directly to the NBA. For the NFL, the rules are that a player has to be out of high school for three years or has used up all their college-eligibility for the next football season. We pulled our dataset for the [NHL](https://www.kaggle.com/datasets/mattop/nhl-draft-hockey-player-data-1963-2022), [NBA](https://www.kaggle.com/datasets/benwieland/nba-draft-data), and the [NFL](https://www.kaggle.com/datasets/jacklichtenstein/espn-nfl-draft-prospect-data?select=nfl_draft_prospects.csv) from Kaggle. 

# NHL 
In the NHL there are seven rounds of draft picks for all 32 teams. Many of these players don’t pan out because the process of getting to the NHL is different than most other sports. Most players are drafted after their senior year of high school. Unless you are one of the top few picks, then you will not be going to the NHL right away. You will have to play junior hockey in order to develop and prepare your body for the NHL game. There are two different paths most people take to develop, Major Junior Hockey and College Hockey. There are other paths but these are the two most common. So most teams draft players in the hopes that they will develop into an NHL player instead of other sports when they are “pro-ready” at the time of the draft. Because of this process many players do not pan out into what they were drafted to be. So in my analysis of draft picks I will start off by looking at those players who did pan out.

I took the draft data from those after the year 2000 and before the year 2018. I removed the last 5 years mainly because many players from those draft classes have not had enough experience or have not had enough time to develop into NHL players yet so their stats will not be a representation of what they can do in the NHL. I also looked at players that had at least 80 games played in the NHL. My representation of a successful NHL player is one that has played around a season in the NHL which is 82 games so I thought that 80 would be an appropriate number. 

With the values in the dataset I tried to create a variable that would represent the overall value of each pick. I started with the point share statistic. Point share is calculated over a few statistics that include:

- Marginal Goals For = (team goals) - (7 / 12) × (team games) × (league goals per game)
- Marginal Goals Against = (1 + (7 / 12)) × (team games) × (league goals per game) - (team goals against)
- Skater Point Shares = (marginal goals) / (marginal goals per point)

“Why 7/12? At even strength a team has six players on the ice, five skaters and one goalie. Imagine each of these players having two chips to contribute to one of two buckets: offense and defense. Collectively the skaters will contribute five chips to the offensive bucket and five chips to the defensive bucket. However, the goalie will contribute both of his chips to the defensive bucket, giving the defensive bucket seven of the twelve chips.”


```{r, out.width="40%", fig.align="center"}
knitr::include_graphics("pictures/STATHOCKEYPICTUREDS.jpeg")
```


This dataset already calculated point shares. From there I created a variable that I labeled win shares. I calculated win shares by dividing points shares by the amount of games played. I did this to see the point shares per game because it appeared from the data that those who had been in the league longer had a higher point share than those who did not have as many games played, so this evened it out for every player regardless of games played. Finally, I created a variable in which I believe calculates the value of each pick in the NHL. This variable was derived by multiplying win shares by points a player has per game and the final measurement I added was the overall pick of a player. 

The reason I added win shares and points per game was because wins shares takes in defensive stats as well and only looks for goals for and against while a player is on the ice while it does not take in the total amount of points the players actually score. I added in the overall pick because this is giving us which picks have the best overall value. This means that if a player selected with the 100th pick is putting up the same production that a player that was taken with the 10th pick then the player who was picked 100th has the better value.

```{r include=FALSE}
#initial importing of the file
#import the nhl draft dataset
nhl <- read_csv("dataforNHL/nhldraft.csv")

#import the map
world_map <- maps::map("world", plot = FALSE, fill = TRUE) %>%
  st_as_sf()

#mutate to change nationalities to coutries on maps
#this may seem a bit tedious but this was the most efficient way I found because some of the abbreviation didn't match up to the package
nhlcountrynames <- nhl %>%
  mutate_if(is.numeric, ~replace_na(.,0))%>%
  mutate(nationality = ifelse(nationality == "CA", paste("Canada"), nationality ))%>%
  mutate(nationality = ifelse(nationality == "US", paste("USA"), nationality ))%>%
  mutate(nationality = ifelse(nationality == "FI", paste("Finland"), nationality ))%>%
  mutate(nationality = ifelse(nationality == "SE", paste("Sweden"), nationality ))%>%
  mutate(nationality = ifelse(nationality == "RU", paste("Russia"), nationality ))%>%
  mutate(nationality = ifelse(nationality == "CZ", paste("Czech Republic"), nationality ))%>%
  mutate(nationality = ifelse(nationality == "FR", paste("France"), nationality ))%>%
  mutate(nationality = ifelse(nationality == "CH", paste("Switzerland"), nationality ))%>%
  mutate(nationality = ifelse(nationality == "DE", paste("Germany"), nationality ))%>%
  mutate(nationality = ifelse(nationality == "SK", paste("Slovakia"), nationality ))%>%
  mutate(nationality = ifelse(nationality == "AT", paste("Austrian"), nationality ))%>%
  mutate(nationality = ifelse(nationality == "AU", paste("Australia"), nationality ))%>%
  mutate(nationality = ifelse(nationality == "DK", paste("Denmark"), nationality ))%>%
  mutate(nationality = ifelse(nationality == "LV", paste("Latvia"), nationality ))%>%
  mutate(nationality = ifelse(nationality == "UA", paste("Ukraine"), nationality ))%>%
  mutate(nationality = ifelse(nationality == "ZA", paste("South Africa"), nationality ))%>%
  mutate(nationality = ifelse(nationality == "EE", paste("Estonia"), nationality ))%>%
  mutate(nationality = ifelse(nationality == "SI", paste("Slovenia"), nationality ))%>%
  mutate(nationality = ifelse(nationality == "NL", paste("Netherlands"), nationality ))%>%
  mutate(nationality = ifelse(nationality == "BY", paste("Belarus"), nationality ))%>%
  mutate(nationality = ifelse(nationality == "GB", paste("UK"), nationality ))%>%
  mutate(nationality = ifelse(nationality == "IT", paste("Italy"), nationality ))%>%
  mutate(nationality = ifelse(nationality == "KZ", paste("Kazakhstan"), nationality ))%>%
  mutate(nationality = ifelse(nationality == "NO", paste("Norway"), nationality ))%>%
  mutate(nationality = ifelse(nationality == "PL", paste("Poland"), nationality ))

#add points per game to the skaters
nhlcountrynames1 <- nhlcountrynames %>%
  mutate(ppg = points/games_played)

#take draft data so players are a minimum 5 years removed from being drafted and in the 21century
nhlpost2000to2017years <- nhlcountrynames1 %>%
  filter(year < 2018)%>%
  filter(year > 1999)

#wrangle to filter people who have played more than 80 games
nhlrelevant <- nhlpost2000to2017years %>%
  filter(games_played > 79)

#mutate to create a variable that divides games played by point shares
nhlmosteffective <- nhlrelevant %>%
  mutate(winshares = point_shares/games_played)%>%
  arrange(desc(winshares))


#make variable that multiplies pick in draft to winshares
nhlmosteffectivetotal1 <- nhlmosteffective %>%
  mutate(valueofpick = winshares * overall_pick)%>%
  arrange(desc(valueofpick))
```

## Skaters

```{r, out.width="40%", fig.align="center"}
knitr::include_graphics("pictures/skatergifds.gif")
```

Once I created the variable I aimed to explore what countries produce the best valued picks. To gauge this I averaged the value of each pick for each country represented in the data set and the results are shown in the figure below:
```{r echo=FALSE, message=FALSE, warning=FALSE}
#This data is only representative of skaters
#make variable that multiplies pick in draft to winshares
nhlmosteffectiveskater1 <- nhlmosteffectivetotal1 %>%
  mutate(valueofskater = winshares * overall_pick * ppg)%>%
  arrange(desc(valueofskater))

# combine the map to the countries for sskaters
worldtotalmap <- nhlmosteffectiveskater1 %>%
  inner_join(world_map, by = c("nationality" = "ID"), multiple = "all")%>%
  mutate_if(is.numeric, ~replace_na(.,0))


#summarize into countries
playerworldranking <- worldtotalmap %>%
  filter(position != "G")%>%
  group_by(nationality, geom) %>%
  summarise(avgpickvalue = mean(valueofskater, na.rm = TRUE))%>%
  arrange(desc(avgpickvalue)) %>%
  mutate(avgpickvalue = ifelse(avgpickvalue==0, NA, avgpickvalue)) %>%
  st_as_sf()

 
my_palette <- colorQuantile(rev(viridis::viridis(3))
                  , domain =  playerworldranking$avgpickvalue, n=5)

leaflet(data = playerworldranking) %>% 
  #addTiles() %>%
  addPolygons(
    fillColor = ~my_palette(avgpickvalue), 
    stroke = FALSE,
    popup = ~ glue::glue("Country: {str_to_title(nationality)} <br> 
                         Average pick: {round(avgpickvalue,3)}")
    , opacity = 1, fillOpacity = 1
    , labelOptions= labelOptions(direction = 'auto')
    , color='#333333'
    , highlightOptions = highlightOptions(color='#000000', weight = 2
                                            , bringToFront = TRUE
                                            , sendToBack = TRUE)) %>%
    addLegend(pal = my_palette,
            values = playerworldranking$avgpickvalue,
           position = "topright",
           title = "Best Valued Skaters Drafted in NHL
            <br> (Based on Value of Pick and Home Country)", opacity = 1)

```


The first map shows us the skaters and Belarus leads the NHL in producing players with the best valued picks. This was surprising to me because as an avid hockey fan I don’t necessarily look at Belarus as a hotspot for hockey players and have not heard of many that have originated there. But upon a further look in the data this is only the case because there are only two successful NHL players that have originated from Belarus and one was extremely successful so this could be a reason the data shows Belarus at the top.

Another observation I derived from the first map was in regards to the powerhouse countries. I consider the powerhouse countries to be:

- United States
- Canada
- Russia
- Sweden 
- Finland
- Czech Republic

Out of these countries it appears that the Czech Republic and Russia are at the top of the rankings while the rest of the countries have a similar average value. This is interesting to me because when it comes to international play the United States and Canada are always pretty dominant so it would be expected that they have the best valued picks. I believe that this is not the case because when it comes to scouting the U.S. born and the Canadian born players there is a vast array of work against the best talents that scouts can see while with the international players there are fewer games and sometimes not against as good of talent seen in North America. This would lead to international players being drafted lower than North American born skaters leading to a higher valuation in the calculation.  

There is another factor that could play a role in the result. When players get drafted from overseas there is always the risk that they will not come to the United States to play hockey and there are many factors for this. Some have already signed pro contracts in their respective homes and are legally required to stay overseas for a few years. Others have fallen in the draft because of threats from their country to come over and play. So because they fall in the draft they might have the same production and talent as those at the top but are ranked higher in the metric because they were drafted lower.


## Goaltenders

INSERT PHOTO

In terms of goaltenders, I used a slightly different calculation for determining the value of each goalie pick. With goaltenders you cannot use points per game and you cannot compare win shares to players because goalies play less games and the point share statistic is calculated differently for goaltenders. 

Point shares are calculated slightly differently for goaltenders. It is based on the formula:

Goalie Point Shares = (2 / 7) × ((marginal goals against) / (marginal goals per point))

“Why 2/7? Of the seven chips contributed to the defensive bucket, two came from the goalie.”

For calculating the value of each pick. I still used the win shares variable. but this time I just multiplied the win shares variable with the overall pick variable and that is how I calculated the value for each pick. I then completed the same process of summarizing the results by country and inputting it into a spatial map. The results are shown below:
```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height= 3}
# make a plot for where the best valued goalies stem from
goaliedata <- nhlmosteffectivetotal1 %>%
  filter(position == "G")%>%
  select(year, overall_pick, team, player, nationality, games_played, 
         goalie_wins, goalie_losses, point_shares, save_percentage, 
         goals_against_average, valueofpick)%>%
  mutate(winpct = goalie_wins/games_played)

goalieworldmap <- goaliedata %>%
  left_join(world_map, by = c("nationality" = "ID"), multiple = "all")%>%
  mutate_if(is.numeric, ~replace_na(.,0))


goalieworldranking <- goalieworldmap %>%
  group_by(nationality, geom) %>%
  summarise(avgpickvalue = mean(valueofpick, na.rm = TRUE))%>%
  arrange(desc(avgpickvalue)) %>%
  mutate(avgpickvalue = ifelse(avgpickvalue==0, NA, avgpickvalue)) %>%
  st_as_sf()

 
my_palette <- colorQuantile(rev(viridis::viridis(4))
                  , domain =  goalieworldranking$avgpickvalue, n=5)

leaflet(data = goalieworldranking) %>% 
  #addTiles() %>%
  addPolygons(
    fillColor = ~my_palette(avgpickvalue), 
    stroke = FALSE,
    popup = ~ glue::glue("Country: {str_to_title(nationality)} <br> 
                         Average pick: {round(avgpickvalue,3)}")
    , opacity = 1, fillOpacity = 1
    , labelOptions= labelOptions(direction = 'auto')
    , color='#333333'
    , highlightOptions = highlightOptions(color='#000000', weight = 2
                                            , bringToFront = TRUE
                                            , sendToBack = TRUE)) %>%
    addLegend(pal = my_palette,
            values = goalieworldranking$avgpickvalue,
           position = "topright",
           title = "Best Valued Skaters Drafted in NHL
            <br> (Based on Value of Pick and Home Country)", opacity = 1)


```

In the second graph that described goalies, the number for value of pick is much higher because points per game is not included and goalies are usually taken later in the draft. The results showed that Switzerland led the pack. 

In terms of powerhouse teams no real country stood out from the pack. The only result that did stand out to me was Russia being at the bottom of the leaderboard. This was surprising to me because in the NHL currently a lot of the top goalies are from Russia, but as made apparent from the map this was not always the case and in recent years there has been a shift in the development of Russian goaltending for them to produce better goaltenders.

## Team
The final observation I wanted to look at was which teams make the best valued picks across the NHL. I did not filter out just to successful players because when it comes to teams picking players I wanted to look at the overall body of work of the team rather than just the successes. For the metric used to evaluate the best teams I just used the win shares variable because I thought this would give me the best look at both goalies and skaters combined when it comes to just looking at teams.

The results of my findings are shown in the table below:
```{r echo=FALSE}
#add points per game to the skaters
nhlppg <- nhl %>%
  mutate(ppg = points/games_played)%>%
  mutate_if(is.numeric, ~replace_na(.,0))

#take draft data so players are a minimum 5 years removed from being drafted and in the 21century
nhlpost2000to2017years1 <- nhlppg %>%
  filter(year < 2018)%>%
  filter(year > 1999)

nhleffectiveness <- nhlpost2000to2017years1 %>%
  mutate(winshares = point_shares/games_played)%>%
  arrange(desc(winshares))

#group by the team and point shares
nhlteamranking <- nhleffectiveness %>%
  group_by(team) %>%
  summarise(avgpickvalue = mean(winshares, na.rm = TRUE) * 100)%>%
  arrange(desc(avgpickvalue))

nhlteamranking%>%
  select(team, avgpickvalue) %>% 
  datatable(colnames = c("Team", "Average Pick Value"),
            filter = 'top',
            options = list(pageLength = 10, autoWidth = TRUE))
```


The final table I feel is the best data for looking at which teams have the best scouts and make the best valued picks in the NHL. 

This table is particularly interesting to me because it allows us to see which teams over the last 20 years have performed well in the draft and those that have performed poorly. It also evaluates which teams have built their teams through the draft rather than those who have traded for their teams.

For example, take a look at the Pittsburgh Penguins who are rated the most effective team when it comes to drafting in the last 20 years. This is a team who has won 3 championships since the year 2000 and has kept their main core together for the better part of 15 years. This is a team who built through the draft and did so good in the draft that they were able to keep their core together.

On the other hand, the Vancouver Canucks are rated the worst team on this list in terms of picking valuable draft picks. This makes sense because over the last 20 years they have not had much success only reaching the Stanley Cup final once. They have drafted a few players that have had success but as an overall body of work they have not drafted well. This also shows up because of their dysfunctional organization that goes through many coaching changes because the team is not performing. With this data the owner should reevaluate and realize that the front office is not doing a good enough job at picking players for their team.

Other notable results:

- Vegas Golden Knights: they are an expansion team that has not relied too much on the draft in the years they have been in the league. They have traded away a lot of their early draft picks and have been in “win now” mode because of their Stanley Cup appearance in the first year of being a franchise
- Arizona Coyotes: have been known for being an underperforming team over the last twenty years. Based on the calculated matrix, it appears that they are one of the best teams when it comes to drafting players. There could be a few explanations for this fact. One could be that they have traded away players they drafted and they then panned out into very successful NHLers. Another reason could be that they have consistently had impact players but have not had enough depth as a team to be at the top of the league.


# NFL 

The NFL draft process occurs when NFL teams pick players, often attending and playing in colleges and universities across the country. The pattern that most typically occurs is the best college football players in the country are often picked in the first couple of rounds. For example, the first player picked in the first round of the draft is likely very talented and highly sought-after. A player’s performance at their college or university is an important consideration for how likely, or quickly they will be picked by an NFL team. Something to consider when looking at players drafted in the NFL, and their corresponding college, is whether there are certain college football teams that produce some of the first picks in the NFL draft. Throughout this analysis we can determine which U.S. states produce some of the top overall NFL draft picks over fifteen years. This information can help us identify states with the top college football players, as well as determine if there are any correlations between the state a player went to school in and the NFL team they were drafted to. 

The data below represents the NFL draft process over a fifteen year period (2006 to 2021). Including in this data included players' names, school they attended, NFL team they were drafted to, the overall pick of each player (ranged 1-32), and the year players were drafted. The map below specifically looks at players' colleges and universities in states across the country and that players' corresponding overall pick number. 


```{r include=FALSE}
#import the NFL draft dataset
nfl <- read_csv("dataforNFL/nfl_draft_picks.csv")

#filter the players that were picked only in the 1st round 
#and only look at years 2017-2021
nflrounds <- nfl%>% 
  filter(Round == 1)%>%
  filter(Year > 2005)

#add states to the dataset 
nfl_with_states <- nflrounds %>%
mutate(
  state_cd = case_when(
    School == "Alabama" ~ "AL",
    School == "Alabama State" ~ "AL",
    School == "Arizona State" ~ "AZ",
    School == "Arizona" ~ "AZ",
    School == "Arkansas" ~"AR", 
    School == "Auburn" ~ "AL", 
    School == "Baylor" ~ "TX", 
    School == "Boise State" ~ "ID", 
    School == "Boston College" ~ "MA", 
    School == "Brigham Young" ~ "UT", 
    School == "Buffalo" ~ "NY",
    School == "California" ~ "CA",
    School == "Central Florida" ~ "FL", 
    School == "Central Michigan" ~ "MI",
    School == "Clemson" ~ "SC", 
    School == "Colorado" ~ "CO",
    School == "Connecticut" ~ "CT", 
    School == "Delaware" ~ "DE", 
    School == "Duke" ~ "NC", 
    School == "East Carolina" ~ "NC",
    School == "Florida" ~ "FL", 
    School == "Florida State" ~ "FL", 
    School == "Fresno State" ~ "CA", 
    School == "Georgia" ~ "GA", 
    School == "Houston" ~ "TX", 
    School == "Idaho" ~ "ID", 
    School == "Illinois" ~ "IL", 
    School == "Iowa" ~ "IA", 
    School == "Kansas" ~ "KS", 
    School == "Kansas State" ~ "KS", 
    School == "Kentucky" ~ "KY", 
    School == "Louisiana State" ~ "LA",
    School == "Louisiana Tech" ~ "LA",
    School == "Louisville" ~ "KY", 
    School == "Maryland" ~ "MD", 
    School == "Memphis" ~ "TN", 
    School == "Miami (FL)" ~ "FL", 
    School == "Michigan" ~ "MI", 
    School == "Michigan State" ~ "MI", 
    School == "Minnesota" ~ "MN", 
    School == "Mississippi" ~ "MS", 
    School == "Mississippi State" ~ "MS", 
    School == "Missouri" ~ "MO", 
    School == "Nebraska" ~ "NE", 
    School == "North Carolina" ~ "NC", 
    School == "North Carolina State" ~ "NC",
    School == "North Dakota State" ~ "ND",
    School == "Northern Illinois" ~ "IL",
    School == "Northwestern" ~ "IL", 
    School == "Notre Dame" ~ "IN", 
    School == "Ohio State" ~ "OH", 
    School == "Oklahoma" ~ "OK", 
    School == "Oklahoma State" ~ "OK",
    School == "Oregon" ~ "OR", 
    School == "Oregon State" ~ "OR", 
    School == "Penn State" ~ "PA", 
    School == "Pittsburgh" ~ "PA",
    School == "Purdue" ~ "IN", 
    School == "Rutgers" ~ "NJ", 
    School == "San Diego State" ~ "CA", 
    School == "South Carolina" ~ "SC", 
    School == "Stanford" ~ "CA", 
    School == "Syracuse" ~ "NY", 
    School == "Temple" ~ "PA", 
    School == "Tennessee" ~ "TN", 
    School == "Tennessee State" ~ "TN", 
    School == "Texas" ~ "TX", 
    School == "Texas A&M" ~ "TX", 
    School == "Texas Christian" ~ "TX", 
    School == "Texas Tech" ~ "TX",
    School == "Texas-San Antonio" ~ "TX", 
    School == "Troy" ~ "AL", 
    School == "Tulsa" ~ "OK", 
    School == "UCLA" ~ "CA", 
    School == "USC" ~ "CA", 
    School == "Utah" ~ "UT", 
    School == "Utah State" ~ "UT", 
    School == "Vanderbilt" ~ "TN", 
    School == "Virginia" ~ "VA", 
    School == "Virginia Tech" ~ "VA", 
    School == "Wake Forest" ~ "NC", 
    School == "Washington" ~ "WA", 
    School == "Washington State" ~ "WA", 
    School == "Western Michigan" ~ "MI", 
    School == "West Virginia" ~ "WV", 
    School == "Wisconsin" ~ "WI", 
    School == "Wyoming" ~ "WY") 
  )

#import the map
states_map <- maps::map("state", regions = ".", plot = FALSE, fill = TRUE) %>%
  st_as_sf()
state_info <- data.frame(state_full = tolower(state.name)
                         , state_cd = state.abb)

#add full name of states to NFL dataset and merge with mapping dataset
nfl_final <- nfl_with_states %>%
  left_join(state_info, by = "state_cd") %>%
  right_join(states_map, by = c("state_full"="ID"))
```

## Map

```{r echo=FALSE, message=FALSE}
#create plot on US country map
ggplot(nfl_final, aes(geometry=geom, fill = Overall)) +
  geom_sf(color = "lightgrey") +
  theme_void() +
  labs(fill = "Overall Draft Pick (1-32)"
       , frame.colour = "black"
       , barwidth = 15
       , barheight = 1.5
       , title = "  U.S. College Football Athletes Drafted in the First Round (from 2006 to 2021)") +
         theme(legend.position="bottom") +
  scale_fill_distiller(palette = "Spectral", direction = 1) 
```

## Table

The table below includes results from the NFL Draft process from 2006 to 2021:
```{r echo=FALSE, message=FALSE}
#user interactive table 
library(DT)
nfl_final %>% 
  select(Name, Position, Overall, School, Year,) %>% 
  datatable(colnames = c("Name", "Position", "Overall Draft Pick", "School", "Year"),
            rownames = head(nfl_final),
            filter = 'top',
            options = list(pageLength = 10, autoWidth = TRUE))
```

## Analysis of Results 

Before analyzing this topic, we had hypothesized that states such as Alabama, Texas, and Louisiana would have some of the highest overall draft picks. I thought this based on the stigma around large football schools in these states, and how seemingly successful they have been over the past few years. However, after using spatial visualizations to further analyze this data we found that states such as New York, Oregon, Wyoming, and Utah have had college football players drafted in the first round and had overall picks of ten or higher, over the period from 2006 to 2021. On the map provided above, these states are colored in red and orange, indicating a player picked relatively high in the first round. Something to consider when looking at this data is that the map only shows data for the first round of the NFL draft, when in reality, there are seven rounds total. If we were to alter the data and look at different rounds, we might see different results. Populations that could find these results interesting are high school recruits whose goal is to make it to the NFL. They could look at the map, or use the search function in the table to see which college or university has consistently sent players to the NFL. To personalize these results further, high school football recruits could search their position and determine what school, and NFL team, previous players have gone to.

Another aspect of the map to consider are the states colored in gray. The grsy-colored states represent states for which there are no colleges that sent players to the first round of the NFL draft from the years 2006 to 2021. We can see there is a concentration of these states in the far northeast portion on the map, considerably the states Maine, Vermont, New Hampshire, and Rhode Island. It is widely assumed and stereotyped that some of the best college football schools are located in the southern and mid-Atlantic portion of the U.S. From these results we can confirm this assumption and determine that some of the most northern states in the country are not as successful, or do not have as talented players, attending school in these states. 


# NBA

```{r echo=FALSE, message=FALSE}
library(tidyverse) 
library(mdsr)
library(spatial)
library(ggplot2)

#importing 20 years of NBA Draft dataset, State Teams, and State Abbreviations
NBA_data <- read_csv("dataforNBA/NBA_draft_data.csv")
NBA_abb <- read_csv("dataforNBA/NBA_abbreviations.csv")
NBA_states <- read_csv("dataforNBA/NBA_state_names.csv")

#cleaning data for visualizations by eliminating the variables not needed

nba_filtered_data <- NBA_data %>%
  rename_at('Tm', ~'Franchise')%>%
  filter(!(DraftYear %in% c(1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999)))%>%
  select(-c(playerurl, DraftYr, MPG, PPG, RPG, APG, VORP, BPM, "WS/48"))%>%
  filter(!(College %in% c(NA)))%>%
  arrange(tolower(Franchise))


#adding team name and state for each player for spatial visualization using inner join function

nba_teams <- inner_join(nba_filtered_data, NBA_abb, by=c("Franchise" = "Abbreviation/"))%>%
  rename_at('Franchise.y', ~'NBA Team(s)')

nba_team_states <- inner_join(nba_teams, NBA_states, by=c("NBA Team(s)" = "NBA Team(s)"))

#creating sf object for US States

states_map <- maps::map("state", regions = "."
                        , plot = FALSE, fill = TRUE) %>%
  sf::st_as_sf()

state_info <- data.frame(state_full = tolower(state.name)
                         , 'State Name' = state.abb)

# performing data analysis to calculate the average points scored by each NBA player

average_points_per_game <- nba_team_states %>% 
  drop_na() %>%
  mutate(avgRaw = TOTPTS/G) %>%
  rename(state = 'State Name') %>%
  group_by(state) %>%
  summarise(finalMean = mean(avgRaw))%>%
  rename(ID = state) %>%
  mutate(ID = tolower(ID)) %>%
  right_join(states_map, by = "ID") 

#creating the U.S. States map to compare the average number of points scored by players per game

ggplot(average_points_per_game, aes(geometry=geom, fill = finalMean)) +
  geom_sf() +
  theme_void() +
  labs(fill = "Average Points(per game)"
       , title = "Average Points Scored by NBA Players in U.S States."
       , caption = "Source: NBA Dataset on Kaggle") +
  scale_fill_viridis_c(option = "magma", direction = -1)
```

```{r echo=FALSE, message=FALSE, warning = FALSE}
# performing data analysis to calculate the value pick of each NBA player using statistically proven method

value_pick_nba <- nba_team_states %>%
  drop_na() %>%
  mutate(valuepick = WS/G)%>%
  rename(statedata = 'State Name')%>%
  group_by(statedata)%>%
  summarise(finalMeanValuePick = mean(valuepick))%>%
  rename(ID = statedata) %>%
  mutate(ID = tolower(ID)) %>%
  right_join(states_map, by = "ID")

#creating the U.S. States map to compare the value pick of NBA players from each state

ggplot(value_pick_nba, aes(geometry=geom, fill = finalMeanValuePick)) +
  geom_sf() +
  theme_void() +
  labs(fill = "Mean Value Pick"
       , title = "Average Mean Value of NBA Players in U.S States."
       , caption = "Source: NBA Dataset on Kaggle") +
  scale_fill_viridis_c(option = "blues", direction = -1)
```

```{r echo=FALSE, message=FALSE, warning = FALSE}
#creating a table to display the top 3 value picks from each State

top_valuepicks <- nba_team_states %>%
  mutate(valuepick = WS/G)%>%
  rename(statedata = 'State Name')%>%
  rename(ID = statedata) %>%
  mutate(ID = tolower(ID)) %>%
  right_join(states_map, by = "ID") %>%
  arrange(desc(valuepick)) %>%
  drop_na() %>%
  group_by(ID) %>%
  slice(1:3)

top_valuepicks_print <- top_valuepicks %>%
  rename(Pick = 'Pk')%>%
  rename(State = 'ID')

final_valuepicks_display <- top_valuepicks_print[, c("Pick", "Franchise", "Player", "College", "NBA Team(s)", "State", "valuepick")]
```
## Analysis
  
  


# Final Thoughts Of Results




# References
https://www.hockey-reference.com/about/point_shares.html
 


